<link rel="import" href="../polymer/polymer-element.html">
<script src="ruler-stuffs.js"></script>

<dom-module id="flow-ruler">
    <template>
        <style>
            .defaultFont {
                /*z-index: 10000;*/
                position: absolute;
                /*height: 1em;*/
                /*width: 1em;*/
                top: -100%;
                left: -100%;
            }
            
            .viewport {
                z-index: 1000000;
                position: fixed;
                /*
                  Despite of what the names say, <vaadin-overlay> is just a container
                  for position/sizing/alignment. The actual overlay is the overlay part.
                */
                /*
                  Default position constraints: the entire viewport. Note: themes can
                  override this to introduce gaps between the overlay and the viewport.
                */
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
/*                background-color: #666666;
                opacity: 0.5;*/
            }
            .default {
                position: absolute;
                height: 0px;
                width: 0px;
            }
        </style> 

        <div id="ruler" 
             class="defaultFont"
             >
            W
        </div>
    </template>

    <script>
        /**
         * `Ruler`
         * A ruler element
         *
         * @customElement
         * @polymer
         */
        class FlowRuler extends Polymer.Element {
            static get is() {
                return 'flow-ruler';
            }
            
            static get properties() {
                return {
                
                };
            }
            
            getFontMetrics() {
                var rulerElement = this.shadowRoot.getElementById("ruler");
                rulerElement.className = 'defaultFont';
                var width = rulerElement.offsetWidth;
                var height = rulerElement.offsetHeight;
                console.log("defaultFont: ",height,width);

                this.$server.updateFontMetrics(width, height);
            }
            
            getViewportSize() {
                var rulerElement = this.shadowRoot.getElementById("ruler");
                rulerElement.className = 'viewport';
                var height = rulerElement.offsetHeight;
                var width = rulerElement.offsetWidth;
                console.log(height,width);

                this.$server.updateViewport(width, height);
            }
            
            getViewportMetrics() {
                // get the DPI
                var rulerElement = this.shadowRoot.getElementById("ruler");
                console.log(rulerElement);
                
                rulerElement.className = 'defaultFont';
                var fontHeight = rulerElement.offsetHeight;
                var fontWidth = rulerElement.offsetWidth;
                
                // now get the viewport size in pixels
                rulerElement.className = 'viewport';
                var vpHeight = rulerElement.offsetHeight;
                var vpWidth = rulerElement.offsetWidth;
                
                var widthInInches = vpWidth / fontWidth;
                var heightInInches = vpHeight / fontHeight;
                console.log(widthInInches, heightInInches);
                
                rulerElement.className = 'defaultFont';
                this.$server.updateViewportMetrics(widthInInches, heightInInches);
            }
        }

        window.customElements.define(FlowRuler.is, FlowRuler);
    </script>
</dom-module>